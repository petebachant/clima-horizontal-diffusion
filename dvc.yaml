stages:
  gen-smag-state:
    cmd: calkit slurm batch --name gen-smag-state --environment clima 
      --dep scripts/gen_smag_state.jl --dep config/base.yml --dep 
      config/smag.yml --dep ClimaAtmos.jl/src --dep ClimaAtmos.jl/toml
      --dep ClimaAtmos.jl/.buildkite/Manifest-v1.11.toml --out 
      results/smag_fixture.jld2 -s --gpus=1 -s --time=30 -- 
      scripts/run.sh ClimaAtmos.jl/.buildkite 
      scripts/gen_smag_state.jl
    deps:
      - scripts/run.sh
      - scripts/gen_smag_state.jl
      - config/base.yml
      - config/smag.yml
      - ClimaAtmos.jl/src
      - ClimaAtmos.jl/toml
      - ClimaAtmos.jl/.buildkite/Manifest-v1.11.toml
    outs:
      - results/smag_fixture.jld2:
          cache: false
          persist: true
      - .calkit/slurm/logs/gen-smag-state.out:
          cache: false
          persist: true
    desc: Automatically generated from the 'gen-smag-state' stage in 
      calkit.yaml. Changes made here will be overwritten.
  nsys-baseline:
    cmd: calkit slurm batch --name nsys-baseline --environment clima 
      --dep config/base.yml --dep config/smag.yml --dep 
      ClimaAtmos.jl/src --dep ClimaAtmos.jl/toml --dep 
      ClimaAtmos.jl/.buildkite/Manifest-v1.11.toml --dep 
      ClimaAtmos.jl/perf/benchmark_step.jl --out 
      results/nsys/baseline.nsys-rep -s --gpus=1 -s --time=60 -- 
      scripts/run-nsys.sh results/nsys/baseline 
      ClimaAtmos.jl/.buildkite config/base.yml config/smag.yml
    deps:
      - scripts/run-nsys.sh
      - config/base.yml
      - config/smag.yml
      - ClimaAtmos.jl/src
      - ClimaAtmos.jl/toml
      - ClimaAtmos.jl/.buildkite/Manifest-v1.11.toml
      - ClimaAtmos.jl/perf/benchmark_step.jl
    outs:
      - results/nsys/baseline.nsys-rep:
          persist: true
      - .calkit/slurm/logs/nsys-baseline.out:
          cache: false
          persist: true
    desc: Automatically generated from the 'nsys-baseline' stage in 
      calkit.yaml. Changes made here will be overwritten.
  nsys-baseline-to-sqlite:
    cmd: ' bash --noprofile --norc -c "nsys export results/nsys/baseline.nsys-rep
      -t sqlite -o results/nsys/baseline.sqlite"'
    deps:
      - results/nsys/baseline.nsys-rep
    outs:
      - results/nsys/baseline.sqlite
    desc: Automatically generated from the 'nsys-baseline-to-sqlite' 
      stage in calkit.yaml. Changes made here will be overwritten.
  nsys-mod:
    cmd: calkit slurm batch --name nsys-mod --environment clima --dep 
      config/base.yml --dep config/smag.yml --dep 
      ClimaAtmos.jl-mod/src --dep ClimaAtmos.jl-mod/toml --dep 
      ClimaAtmos.jl-mod/.buildkite/Manifest-v1.11.toml --dep 
      ClimaAtmos.jl/perf/benchmark_step.jl --out 
      results/nsys/mod.nsys-rep -s --gpus=1 -s --time=60 -- 
      scripts/run-nsys.sh results/nsys/mod 
      ClimaAtmos.jl-mod/.buildkite config/base.yml config/smag.yml
    deps:
      - scripts/run-nsys.sh
      - config/base.yml
      - config/smag.yml
      - ClimaAtmos.jl-mod/src
      - ClimaAtmos.jl-mod/toml
      - ClimaAtmos.jl-mod/.buildkite/Manifest-v1.11.toml
      - ClimaAtmos.jl/perf/benchmark_step.jl
    outs:
      - results/nsys/mod.nsys-rep:
          persist: true
      - .calkit/slurm/logs/nsys-mod.out:
          cache: false
          persist: true
    desc: Automatically generated from the 'nsys-mod' stage in 
      calkit.yaml. Changes made here will be overwritten.
  nsys-mod-to-sqlite:
    cmd: ' bash --noprofile --norc -c "nsys export results/nsys/mod.nsys-rep
      -t sqlite -o results/nsys/mod.sqlite"'
    deps:
      - results/nsys/mod.nsys-rep
    outs:
      - results/nsys/mod.sqlite
    desc: Automatically generated from the 'nsys-mod-to-sqlite' stage 
      in calkit.yaml. Changes made here will be overwritten.
  nsys-baseline-const:
    cmd: calkit slurm batch --name nsys-baseline-const --environment 
      clima --dep config/base.yml --dep config/const.yml --dep 
      ClimaAtmos.jl/src --dep ClimaAtmos.jl/toml --dep 
      ClimaAtmos.jl/.buildkite/Manifest-v1.11.toml --dep 
      ClimaAtmos.jl/perf/benchmark_step.jl --out 
      results/nsys/baseline-const.nsys-rep -s --gpus=1 -s --time=60 --
      scripts/run-nsys.sh results/nsys/baseline-const 
      ClimaAtmos.jl/.buildkite config/base.yml config/const.yml
    deps:
      - scripts/run-nsys.sh
      - config/base.yml
      - config/const.yml
      - ClimaAtmos.jl/src
      - ClimaAtmos.jl/toml
      - ClimaAtmos.jl/.buildkite/Manifest-v1.11.toml
      - ClimaAtmos.jl/perf/benchmark_step.jl
    outs:
      - results/nsys/baseline-const.nsys-rep:
          persist: true
      - .calkit/slurm/logs/nsys-baseline-const.out:
          cache: false
          persist: true
    desc: Automatically generated from the 'nsys-baseline-const' stage
      in calkit.yaml. Changes made here will be overwritten.
  nsys-baseline-const-to-sqlite:
    cmd: ' bash --noprofile --norc -c "nsys export results/nsys/baseline-const.nsys-rep
      -t sqlite -o results/nsys/baseline-const.sqlite"'
    deps:
      - results/nsys/baseline-const.nsys-rep
    outs:
      - results/nsys/baseline-const.sqlite
    desc: Automatically generated from the 
      'nsys-baseline-const-to-sqlite' stage in calkit.yaml. Changes 
      made here will be overwritten.
  summarize:
    cmd: calkit xenv -n py --no-check -- python scripts/summarize.py
    deps:
      - scripts/summarize.py
      - results/nsys/baseline.sqlite
      - results/nsys/mod.sqlite
      - results/nsys/baseline-const.sqlite
      - .calkit/env-locks/py
    outs:
      - results/summary.csv:
          cache: false
          persist: false
    desc: Automatically generated from the 'summarize' stage in 
      calkit.yaml. Changes made here will be overwritten.
